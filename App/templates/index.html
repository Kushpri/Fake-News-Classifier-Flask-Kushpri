<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Fake News Detection System</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; background: #f4f6f9; color: #222; }
    .container{ max-width:900px; margin: 0 auto; }
    textarea{ width:100%; min-height:160px; padding:10px; font-size:15px; box-sizing:border-box; }
    .btn{ background:#007bff; color:white; padding:10px 16px; border:none; cursor:pointer; font-size:16px; }
    .result { margin-top:18px; padding:14px; background:white; border-radius:8px; box-shadow:0 1px 6px rgba(0,0,0,0.06); }
    .prediction { font-weight:700; font-size:18px; }
    .confidence { margin-top:6px; color:#555; font-size:14px; }
    .hidden{ display:none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fake News Detection System</h1>

    <form id="newsForm" method="POST" action="/predict">
      <label for="news">Enter News Text:</label><br/>
      <textarea id="news" name="news" placeholder="Write or paste news article here..."></textarea>
      <br/><br/>
      <button type="submit" class="btn">Check News</button>
    </form>

    <!-- CLIENT-SIDE RESULT (filled by JS when using AJAX) -->
    <div id="clientResult" class="result hidden" role="status" aria-live="polite">
      <div class="prediction" id="clientPrediction"></div>
      <div class="confidence" id="clientConfidence"></div>
    </div>

    <!-- SERVER-SIDE RESULT (fallback when JS is disabled and server renders) -->
    {% if prediction %}
      <div id="serverResult" class="result" role="status" aria-live="polite" style="margin-top:20px;">
        <div class="prediction">Prediction: {{ prediction }}</div>
        {% if confidence %}
          <div class="confidence">Confidence: {{ confidence }}</div>
        {% endif %}
      </div>
    {% endif %}

    <hr style="margin-top:28px"/>

    <p style="color:#666">This page uses a ML model to classify text. If you see duplicates previously, the updated client/server JSON approach prevents that issue.</p>
  </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("newsForm");
  const clientResult = document.getElementById("clientResult");
  const clientPrediction = document.getElementById("clientPrediction");
  const clientConfidence = document.getElementById("clientConfidence");

  form.addEventListener("submit", async function(e) {
    // prevent the default full-page form post and use AJAX (JSON)
    e.preventDefault();

    const text = document.getElementById("news").value || "";
    if (!text.trim()) {
      alert("Please enter some news text first.");
      return;
    }

    // hide any previous server result to avoid confusion
    const serverRes = document.getElementById("serverResult");
    if (serverRes) serverRes.style.display = "none";

    // call JSON API
    try {
      const resp = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ news: text })
      });

      if (!resp.ok) {
        const txt = await resp.text();
        throw new Error("Server error: " + resp.status + " " + txt);
      }

      const data = await resp.json();
      if (data.error) throw new Error(data.error);

      clientPrediction.textContent = "Prediction: " + data.prediction;
      clientConfidence.textContent = "Confidence: " + data.confidence + "%";
      clientResult.classList.remove("hidden");
      // optionally scroll to result
      clientResult.scrollIntoView({ behavior: "smooth" });
    } catch (err) {
      alert("Error: " + err.message);
      console.error(err);
    }
  });
});
</script>
</body>
</html>
